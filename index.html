<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Find the Perfect Meeting Time</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #fafafa;
  }
  h1 {
    text-align: center;
  }
  .highlight {
    color: #00a884;
  }
  .form-container {
    max-width: 600px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
  }
  .form-group {
    margin-bottom: 15px;
  }
  label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }
  input, select, button {
    padding: 8px;
    font-size: 14px;
  }
  button {
    background: #00a884;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background: #008f6e;
  }
  .time-range {
    display: flex;
    gap: 10px;
  }
  .timezone-add {
    display: flex;
    gap: 10px;
  }
  #timezone-list {
    list-style: none;
    padding: 0;
    margin-top: 10px;
  }
  #timezone-list li {
    background: #e7f8f3;
    padding: 5px;
    margin: 3px 0;
    display: flex;
    justify-content: space-between;
  }
  #slots-container {
    max-width: 600px;
    margin: 20px auto;
  }
  .slot {
    border: 1px solid #ddd;
    padding: 10px;
    margin: 5px 0;
    background: white;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>

<h1>Find the Perfect <span class="highlight">Meeting Time</span></h1>

<div class="form-container">
  <div class="form-group">
    <label>Meeting Date</label>
    <input type="date" id="meeting-date">
  </div>

  <div class="form-group">
    <label>Meeting Title <span style="color:red">*</span></label>
    <input type="text" id="meeting-title" placeholder="Enter meeting title">
  </div>

  <div class="form-group">
    <label>Office Hours</label>
    <div class="time-range">
      <input type="time" id="start-time" value="09:00">
      <input type="time" id="end-time" value="17:00">
    </div>
  </div>

  <div class="form-group">
    <label>Participant Timezones</label>
    <div class="timezone-add">
      <select id="timezone-select"></select>
      <button id="add-timezone" type="button">Add</button>
    </div>
    <ul id="timezone-list"></ul>
  </div>

  <button id="find-slots" type="button">Find Overlapping Slots</button>
</div>

<div id="slots-container" class="hidden">
  <h2>Available Time Slots</h2>
  <div id="slots-list"></div>
  <button id="create-poll" type="button">Create Poll & Get Link</button>
</div>

<script>
// Populate timezone dropdown
const timezoneSelect = document.getElementById("timezone-select");
Intl.supportedValuesOf("timeZone").forEach(tz => {
  const option = document.createElement("option");
  option.value = tz;
  option.textContent = tz;
  timezoneSelect.appendChild(option);
});

const timezones = [];
document.getElementById("add-timezone").addEventListener("click", () => {
  const tz = timezoneSelect.value;
  if (!timezones.includes(tz)) {
    timezones.push(tz);
    updateTimezoneList();
  }
});

function updateTimezoneList() {
  const list = document.getElementById("timezone-list");
  list.innerHTML = "";
  timezones.forEach(tz => {
    const li = document.createElement("li");
    li.textContent = tz;
    const btn = document.createElement("button");
    btn.textContent = "X";
    btn.onclick = () => {
      timezones.splice(timezones.indexOf(tz), 1);
      updateTimezoneList();
    };
    li.appendChild(btn);
    list.appendChild(li);
  });
}

// Find overlapping slots
document.getElementById("find-slots").addEventListener("click", () => {
  const title = document.getElementById("meeting-title").value.trim();
  const date = document.getElementById("meeting-date").value;
  const startTime = document.getElementById("start-time").value;
  const endTime = document.getElementById("end-time").value;

  if (!title || !date || timezones.length < 2) {
    alert("Please fill all required fields and add at least 2 timezones.");
    return;
  }

  const slots = calculateSlots(date, startTime, endTime);
  renderSlots(slots);
  document.getElementById("slots-container").classList.remove("hidden");
});

function calculateSlots(date, start, end) {
  const slots = [];
  let startDate = new Date(`${date}T${start}:00Z`);
  let endDate = new Date(`${date}T${end}:00Z`);

  while (startDate < endDate) {
    const slotTimes = timezones.map(tz => ({
      timezone: tz,
      time: startDate.toLocaleString("en-US", { 
        timeZone: tz, 
        weekday: "short", 
        month: "short",
        day: "numeric",
        hour: "2-digit", 
        minute: "2-digit" 
      })
    }));
    slots.push(slotTimes);
    startDate = new Date(startDate.getTime() + 15 * 60 * 1000);
  }
  return slots;
}

function renderSlots(slots) {
  const container = document.getElementById("slots-list");
  container.innerHTML = "";
  slots.forEach(slot => {
    const div = document.createElement("div");
    div.className = "slot";
    slot.forEach(s => {
      const p = document.createElement("p");
      p.textContent = `${s.timezone}: ${s.time}`;
      div.appendChild(p);
    });
    container.appendChild(div);
  });
}

// Placeholder for "Create Poll" - you will replace with Firebase later
document.getElementById("create-poll").addEventListener("click", () => {
  alert("Poll link generated! (Integrate Firebase here)");
});
</script>

</body>
</html>
